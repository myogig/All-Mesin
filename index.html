<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List All Mesin - Data PM Mesin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container-fluid py-4">
        <div class="row">
            <div class="col-12">
                <h1 class="mb-4 text-center">List All Mesin</h1>
                
                <!-- Control Panel -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <!-- Action Buttons -->
                                    <div class="col-md-8">
                                        <div class="btn-group me-2" role="group">
                                            <button type="button" class="btn btn-new" id="btnNew">
                                                <i class="fas fa-plus"></i> New
                                            </button>
                                            <button type="button" class="btn btn-edit" id="btnEdit">
                                                <i class="fas fa-edit"></i> Edit
                                            </button>
                                            <button type="button" class="btn btn-update" id="btnUpdate">
                                                <i class="fas fa-sync"></i> Update Data
                                            </button>
                                            <button type="button" class="btn btn-complete" id="btnComplete">
                                                <i class="fas fa-check"></i> Selesai PM
                                            </button>
                                        </div>
                                        
                                        <div class="btn-group me-2" role="group">
                                            <button type="button" class="btn btn-danger" id="btnDelete">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                            <button type="button" class="btn btn-danger" id="btnDeleteAll">
                                                <i class="fas fa-trash-alt"></i> All Delete
                                            </button>
                                        </div>
                                        
                                        <div class="btn-group" role="group">
                                            <button type="button" class="btn btn-info" id="btnExport">
                                                <i class="fas fa-file-pdf"></i> Export
                                            </button>
                                            <button type="button" class="btn btn-warning" id="btnImport">
                                                <i class="fas fa-file-excel"></i> Import
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Search -->
                                    <div class="col-md-4">
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="searchInput" 
                                                   placeholder="Filter by Pengelola/Periode PM/Status">
                                            <button class="btn btn-outline-secondary" type="button" id="btnSearch">
                                                <i class="fas fa-search"></i> Cari
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Data Table -->
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">Data PM Mesin</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="machineTable">
                                <thead class="table-dark">
                                    <tr>
                                        <th>No</th>
                                        <th>Id Msn</th>
                                        <th>Alamat</th>
                                        <th>Pengelola</th>
                                        <th>Periode PM</th>
                                        <th>Tgl Selesai PM</th>
                                        <th>Status</th>
                                        <th>Teknisi</th>
                                    </tr>
                                </thead>
                                <tbody id="machineTableBody">
                                    {% for machine in machines %}
                                    <tr>
                                        <td>{{ machine.no }}</td>
                                        <td class="id-msn-cell clickable" data-id-msn="{{ machine.id_msn }}">
                                            {{ machine.id_msn }}
                                        </td>
                                        <td>{{ machine.alamat }}</td>
                                        <td>{{ machine.pengelola }}</td>
                                        <td>{{ machine.periode_pm or '' }}</td>
                                        <td>{{ machine.tgl_selesai_pm or '' }}</td>
                                        <td>
                                            <span class="status-badge status-{{ machine.status.lower() }}">
                                                {{ machine.status }}
                                            </span>
                                        </td>
                                        <td>{{ machine.teknisi }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- New Machine Modal -->
    <div class="modal fade" id="newMachineModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Tambah Mesin Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newMachineForm">
                        <div class="mb-3">
                            <label for="newIdMsn" class="form-label">Id Msn</label>
                            <input type="text" class="form-control" id="newIdMsn" required>
                        </div>
                        <div class="mb-3">
                            <label for="newAlamat" class="form-label">Alamat</label>
                            <input type="text" class="form-control" id="newAlamat" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPengelola" class="form-label">Pengelola</label>
                            <input type="text" class="form-control" id="newPengelola" required>
                        </div>
                        <div class="mb-3">
                            <label for="newTeknisi" class="form-label">Teknisi</label>
                            <input type="text" class="form-control" id="newTeknisi" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-new" id="saveNewMachine">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Machine Modal -->
    <div class="modal fade" id="editMachineModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Mesin</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editMachineForm">
                        <div class="mb-3">
                            <label for="editIdMsn" class="form-label">Id Msn</label>
                            <input type="text" class="form-control" id="editIdMsn" required>
                        </div>
                        <div class="mb-3">
                            <label for="editAlamat" class="form-label">Alamat</label>
                            <input type="text" class="form-control" id="editAlamat" required>
                        </div>
                        <div class="mb-3">
                            <label for="editPengelola" class="form-label">Pengelola</label>
                            <input type="text" class="form-control" id="editPengelola" required>
                        </div>
                        <div class="mb-3">
                            <label for="editTeknisi" class="form-label">Teknisi</label>
                            <input type="text" class="form-control" id="editTeknisi" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-edit" id="saveEditMachine">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update PM Modal -->
    <div class="modal fade" id="updatePMModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Update Data PM</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="updatePMForm">
                        <div class="mb-3">
                            <label for="updateIdMsn" class="form-label">Id Msn</label>
                            <select class="form-select" id="updateIdMsn" required>
                                <option value="">Pilih Id Msn</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="updateAlamat" class="form-label">Alamat</label>
                            <input type="text" class="form-control" id="updateAlamat" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="updatePengelola" class="form-label">Pengelola</label>
                            <input type="text" class="form-control" id="updatePengelola" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="updateTeknisi" class="form-label">Teknisi</label>
                            <input type="text" class="form-control" id="updateTeknisi" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="updatePeriodePM" class="form-label">Periode PM</label>
                            <input type="text" class="form-control" id="updatePeriodePM" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-update" id="saveUpdatePM">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Complete PM Modal -->
    <div class="modal fade" id="completePMModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Selesai PM</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="completePMForm">
                        <div class="mb-3">
                            <label for="completeIdMsn" class="form-label">Id Msn</label>
                            <select class="form-select" id="completeIdMsn" required>
                                <option value="">Pilih Id Msn</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="completePeriodePM" class="form-label">Periode PM</label>
                            <input type="text" class="form-control" id="completePeriodePM" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="completeTeknisi" class="form-label">Teknisi</label>
                            <input type="text" class="form-control" id="completeTeknisi" readonly>
                        </div>
                        <div class="mb-3">
                            <label for="completeTglSelesai" class="form-label">Tgl Selesai PM</label>
                            <input type="date" class="form-control" id="completeTglSelesai" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-complete" id="saveCompletePM">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notes Modal -->
    <div class="modal fade" id="notesModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Notes untuk <span id="notesIdMsn"></span></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <textarea class="form-control" id="notesText" rows="4" placeholder="Masukkan catatan..."></textarea>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveNotes">Save Notes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal fade" id="importModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Import Data</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="importFile" class="form-label">Pilih File Excel</label>
                        <input type="file" class="form-control" id="importFile" accept=".xlsx,.xls">
                        <div class="form-text">File harus berisi kolom: Id Msn, Alamat, Pengelola, Periode PM, Tgl Selesai PM, Status, Teknisi</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-warning" id="saveImport">Import</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>
